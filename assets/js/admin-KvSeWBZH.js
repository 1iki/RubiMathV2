import{b as X,r as h,j as a}from"./vendor-BjgPdEnQ.js";import{s as c}from"./game-C_1TzDD9.js";const Q=()=>{var K;const D=X(),[g,J]=h.useState(""),S=e=>/^[0-9+\-\s]{8,20}$/.test(e),R=e=>g?e.filter(n=>{var t,d,o,m,j,p,w,U,q,P,$,I;const i=g.toLowerCase();switch(l){case"siswa":return((t=n.nama)==null?void 0:t.toLowerCase().includes(i))||((d=n.nis)==null?void 0:d.toLowerCase().includes(i))||((o=n.alamat)==null?void 0:o.toLowerCase().includes(i));case"guru":return((m=n.nama)==null?void 0:m.toLowerCase().includes(i))||((j=n.nuptk)==null?void 0:j.toLowerCase().includes(i))||((p=n.no_telp)==null?void 0:p.includes(g))||((w=n.alamat)==null?void 0:w.toLowerCase().includes(i));case"wali":return((U=n.nama)==null?void 0:U.toLowerCase().includes(i))||((q=n.no_telp)==null?void 0:q.includes(g))||((P=n.alamat)==null?void 0:P.toLowerCase().includes(i));case"admin":return(($=n.nama)==null?void 0:$.toLowerCase().includes(i))||((I=n.tipe_admin)==null?void 0:I.toLowerCase().includes(i));default:return!1}}):e,[u,A]=h.useState({siswa:[],guru:[],wali:[],admin:[]}),[E,F]=h.useState([]),[M,T]=h.useState(!0),[l,_]=h.useState("siswa"),[H,x]=h.useState(!1),[f,k]=h.useState(!1),[L,b]=h.useState(null),[s,r]=h.useState({nama:"",nis:"",tanggal_lahir:"",alamat:"",id_kelas:"",id_wali:"",Jenis_Kelamin:"",nuptk:"",no_telp:"",kelas:"",tipe_admin:"",password:"",auth_user_id:null});h.useEffect(()=>{v(),O()},[]);const v=async()=>{T(!0);try{const[e,n,i,t]=await Promise.all([c.from("siswa").select(`
            *,
            wali:id_wali (
              nama
            )
          `),c.from("guru").select("*"),c.from("wali").select("*"),c.from("admin").select("*")]);if(e.error)throw new Error(`Error fetching siswa: ${e.error.message}`);if(n.error)throw new Error(`Error fetching guru: ${n.error.message}`);if(i.error)throw new Error(`Error fetching wali: ${i.error.message}`);if(t.error)throw new Error(`Error fetching admin: ${t.error.message}`);A({siswa:e.data||[],guru:n.data||[],wali:i.data||[],admin:t.data||[]})}catch(e){console.error("Error fetching users:",e),alert("Error fetching users: "+e.message)}finally{T(!1)}},O=async()=>{try{const{data:e,error:n}=await c.from("kelas").select("*").order("nama_kelas",{ascending:!0});if(n)throw n;F(e||[])}catch(e){console.error("Error fetching kelas:",e),alert("Error fetching kelas data: "+e.message)}},W=async()=>{try{const{error:e}=await c.auth.signOut();if(e)throw e;localStorage.removeItem("isLoggedIn"),localStorage.removeItem("userRole"),D("/login")}catch(e){console.error("Error logging out:",e),alert("Error logging out. Please try again.")}},N=async(e,n,i)=>{let t="";switch(n){case"siswa":t=`Apakah Anda yakin ingin menghapus siswa "${i.nama}" dengan NIS ${i.nis}?

Peringatan: Tindakan ini akan menghapus semua data terkait siswa termasuk:
- Catatan siswa
- Riwayat kemajuan
- Nilai-nilai`;break;case"guru":t=`Apakah Anda yakin ingin menghapus guru "${i.nama}" dengan NUPTK ${i.nuptk}?

Peringatan: Tindakan ini akan mempengaruhi data kelas yang diajar oleh guru ini.`;break;case"wali":t=`Apakah Anda yakin ingin menghapus wali murid "${i.nama}"?

Peringatan: Pastikan tidak ada siswa yang masih terkait dengan wali ini.`;break;case"admin":t=`Apakah Anda yakin ingin menghapus admin "${i.nama}" (${i.tipe_admin})?`;break;default:t="Apakah Anda yakin ingin menghapus pengguna ini?"}if(window.confirm(t))try{let d,o;if(n==="siswa"){d="siswa",o="id_siswa";const{error:j}=await c.from("siswa_catatan").delete().eq("id_siswa",e);if(j)throw j;const{error:p}=await c.from("kemajuan").delete().eq("id_siswa",e);if(p)throw p;const{error:w}=await c.from("nilai").delete().eq("id_siswa",e);if(w)throw w}else if(n==="guru")d="guru",o="id_guru";else if(n==="wali")d="wali",o="id_wali";else if(n==="admin")d="admin",o="id_admin";else throw new Error("Unknown role");const{error:m}=await c.from(d).delete().eq(o,e);if(m)throw m;alert(`${n.charAt(0).toUpperCase()+n.slice(1)} berhasil dihapus!`),v()}catch(d){console.error("Error deleting user:",d),alert("Error deleting user: "+d.message)}},B=async()=>{try{const e=l;if((l==="guru"||l==="wali")&&!S(s.no_telp))throw new Error("Nomor telepon harus terdiri dari 8-20 karakter dan hanya boleh mengandung angka, tanda plus, strip, dan spasi");let n={...s};switch(l){case"siswa":n={nama:s.nama,nis:s.nis,tanggal_lahir:s.tanggal_lahir,alamat:s.alamat,id_kelas:parseInt(s.id_kelas),id_wali:parseInt(s.id_wali),Jenis_Kelamin:s.Jenis_Kelamin,id_role:4};break;case"guru":n={nama:s.nama,nuptk:s.nuptk,no_telp:s.no_telp,alamat:s.alamat,kelas:s.kelas,id_role:2};break;case"wali":n={nama:s.nama,alamat:s.alamat,no_telp:s.no_telp,id_role:3};break;case"admin":n={nama:s.nama,tipe_admin:s.tipe_admin};break;default:throw new Error("Invalid user type")}let i=null;if(l==="siswa"?i=await c.from(e).select().eq("nis",s.nis).single():l==="guru"&&(i=await c.from(e).select().eq("nuptk",s.nuptk).single()),i!=null&&i.data)throw new Error(`${l} dengan ${l==="siswa"?"NIS":"NUPTK"} tersebut sudah ada`);const{data:t,error:d}=await c.from(e).insert([n]).select();if(d)throw d;A(o=>({...o,[l]:[...o[l],t[0]]})),x(!1),r(y),alert("Pengguna berhasil ditambahkan!"),v()}catch(e){console.error("Error creating user:",e),alert("Error creating user: "+e.message)}},G=async()=>{try{const e=l;let n,i;if((l==="guru"||l==="wali")&&!S(s.no_telp))throw new Error("Nomor telepon harus terdiri dari 8-20 karakter dan hanya boleh mengandung angka, tanda plus, strip, dan spasi");switch(l){case"siswa":n="id_siswa",i={nama:s.nama,nis:s.nis,tanggal_lahir:s.tanggal_lahir,alamat:s.alamat,id_kelas:parseInt(s.id_kelas),id_wali:parseInt(s.id_wali),Jenis_Kelamin:s.Jenis_Kelamin};break;case"guru":n="id_guru",i={nama:s.nama,nuptk:s.nuptk,no_telp:s.no_telp,alamat:s.alamat,kelas:s.kelas};break;case"wali":n="id_wali",i={nama:s.nama,alamat:s.alamat,no_telp:s.no_telp};break;case"admin":n="id_admin",i={nama:s.nama,tipe_admin:s.tipe_admin};break;default:throw new Error("Invalid user type")}const{error:t}=await c.from(e).update(i).eq(n,L[n]);if(t)throw t;A(d=>({...d,[l]:d[l].map(o=>o[n]===L[n]?{...o,...i}:o)})),x(!1),k(!1),b(null),r(y),alert("Pengguna berhasil diperbarui!"),v()}catch(e){console.error("Error updating user:",e),alert(e.message)}},C=e=>{b(e),r({...e,id_wali:e.id_wali?e.id_wali.toString():"",id_kelas:e.id_kelas?e.id_kelas.toString():"",nama:e.nama||"",nis:e.nis||"",nuptk:e.nuptk||"",tanggal_lahir:e.tanggal_lahir||"",Jenis_Kelamin:e.Jenis_Kelamin||"",alamat:e.alamat||"",no_telp:e.no_telp||"",kelas:e.kelas||"",tipe_admin:e.tipe_admin||""}),k(!0),x(!0)},y={nama:"",nis:"",tanggal_lahir:"",alamat:"",id_kelas:"",id_wali:"",Jenis_Kelamin:"",nuptk:"",no_telp:"",kelas:"",tipe_admin:"",password:"",auth_user_id:null},z=()=>a.jsx("div",{className:`modal ${H?"show":""}`,children:a.jsxs("div",{className:"modal-content",children:[a.jsxs("h2",{children:[f?"Edit":"Tambah"," ",l]}),a.jsxs("form",{onSubmit:e=>{e.preventDefault(),f?G():B()},children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Nama:"}),a.jsx("input",{type:"text",value:s.nama,onChange:e=>r({...s,nama:e.target.value}),required:!0})]}),l==="siswa"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"NIS:"}),a.jsx("input",{type:"text",value:s.nis,onChange:e=>r({...s,nis:e.target.value}),required:!0})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Tanggal Lahir:"}),a.jsx("input",{type:"date",value:s.tanggal_lahir,onChange:e=>r({...s,tanggal_lahir:e.target.value}),required:!0})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Alamat:"}),a.jsx("textarea",{value:s.alamat,onChange:e=>r({...s,alamat:e.target.value}),required:!0})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Kelas:"}),a.jsxs("select",{value:s.id_kelas,onChange:e=>r({...s,id_kelas:e.target.value}),required:!0,children:[a.jsx("option",{value:"",children:"Pilih Kelas"}),E.map(e=>a.jsx("option",{value:e.id_kelas,children:e.nama_kelas},e.id_kelas))]})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Wali:"}),a.jsxs("select",{value:s.id_wali,onChange:e=>r({...s,id_wali:e.target.value}),required:!0,children:[a.jsx("option",{value:"",children:"Pilih Wali"}),u.wali.map(e=>a.jsx("option",{value:e.id_wali,children:e.nama},e.id_wali))]})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Jenis Kelamin:"}),a.jsxs("select",{value:s.Jenis_Kelamin,onChange:e=>r({...s,Jenis_Kelamin:e.target.value}),required:!0,children:[a.jsx("option",{value:"",children:"Pilih Jenis Kelamin"}),a.jsx("option",{value:"L",children:"Laki-laki"}),a.jsx("option",{value:"P",children:"Perempuan"})]})]})]}),l==="guru"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"NUPTK:"}),a.jsx("input",{type:"text",value:s.nuptk,onChange:e=>r({...s,nuptk:e.target.value}),required:!0})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"No. Telepon:"}),a.jsx("input",{type:"tel",value:s.no_telp,onChange:e=>r({...s,no_telp:e.target.value}),required:!0})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Alamat:"}),a.jsx("textarea",{value:s.alamat,onChange:e=>r({...s,alamat:e.target.value}),required:!0})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Kelas:"}),a.jsxs("select",{value:s.kelas,onChange:e=>r({...s,kelas:e.target.value}),required:!0,children:[a.jsx("option",{value:"",children:"Pilih Kelas"}),E.map(e=>a.jsx("option",{value:e.nama_kelas,children:e.nama_kelas},e.id_kelas))]})]})]}),l==="wali"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"No. Telepon:"}),a.jsx("input",{type:"tel",value:s.no_telp,onChange:e=>r({...s,no_telp:e.target.value}),required:!0})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Alamat:"}),a.jsx("textarea",{value:s.alamat,onChange:e=>r({...s,alamat:e.target.value}),required:!0})]})]}),l==="admin"&&a.jsx(a.Fragment,{children:a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Tipe Admin:"}),a.jsxs("select",{value:s.tipe_admin,onChange:e=>r({...s,tipe_admin:e.target.value}),required:!0,children:[a.jsx("option",{value:"",children:"Pilih Tipe Admin"}),a.jsx("option",{value:"super",children:"Super Admin"}),a.jsx("option",{value:"regular",children:"Regular Admin"})]})]})}),!f&&a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Password:"}),a.jsx("input",{type:"password",value:s.password,onChange:e=>r({...s,password:e.target.value}),required:!0})]}),a.jsxs("div",{className:"modal-actions",children:[a.jsx("button",{type:"submit",children:f?"Update":"Simpan"}),a.jsx("button",{type:"button",onClick:()=>{x(!1),k(!1),b(null),r(y)},children:"Batal"})]})]})]})}),V=()=>{const e=u[l]||[],n=R(e);if(M)return a.jsxs("div",{className:"loading",children:[a.jsx("i",{className:"fas fa-spinner"})," Loading users..."]});const i=()=>{switch(l){case"siswa":return a.jsxs("table",{className:"user-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"NIS"}),a.jsx("th",{children:"Nama"}),a.jsx("th",{children:"Tanggal Lahir"}),a.jsx("th",{children:"Alamat"}),a.jsx("th",{children:"Kelas"}),a.jsx("th",{children:"Wali"}),a.jsx("th",{children:"Jenis Kelamin"}),a.jsx("th",{children:"Avatar"}),a.jsx("th",{children:"Created At"}),a.jsx("th",{children:"Updated At"}),a.jsx("th",{children:"Aksi"})]})}),a.jsx("tbody",{children:n.map(t=>{var d,o;return a.jsxs("tr",{children:[a.jsx("td",{children:t.nis}),a.jsx("td",{children:t.nama}),a.jsx("td",{children:t.tanggal_lahir}),a.jsx("td",{children:t.alamat}),a.jsx("td",{children:((d=E.find(m=>m.id_kelas===t.id_kelas))==null?void 0:d.nama_kelas)||"-"}),a.jsx("td",{children:((o=t.wali)==null?void 0:o.nama)||"-"}),a.jsx("td",{children:t.Jenis_Kelamin}),a.jsx("td",{children:t.avatar?"✓":"✗"}),a.jsx("td",{children:new Date(t.created_at).toLocaleDateString()}),a.jsx("td",{children:new Date(t.updated_at).toLocaleDateString()}),a.jsxs("td",{children:[a.jsxs("button",{className:"edit-button",onClick:()=>C(t),children:[a.jsx("i",{className:"fas fa-edit mr-2"}),"Edit"]}),a.jsxs("button",{className:"delete-button",onClick:()=>N(t.id_siswa,"siswa",t),children:[a.jsx("i",{className:"fas fa-trash-alt mr-2"}),"Hapus"]})]})]},t.id_siswa)})})]});case"guru":return a.jsxs("table",{className:"user-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"NUPTK"}),a.jsx("th",{children:"Nama"}),a.jsx("th",{children:"No. Telepon"}),a.jsx("th",{children:"Alamat"}),a.jsx("th",{children:"Kelas"}),a.jsx("th",{children:"Created At"}),a.jsx("th",{children:"Updated At"}),a.jsx("th",{children:"Aksi"})]})}),a.jsx("tbody",{children:n.map(t=>a.jsxs("tr",{children:[a.jsx("td",{children:t.nuptk}),a.jsx("td",{children:t.nama}),a.jsx("td",{children:t.no_telp}),a.jsx("td",{children:t.alamat}),a.jsx("td",{children:t.kelas}),a.jsx("td",{children:new Date(t.created_at).toLocaleDateString()}),a.jsx("td",{children:new Date(t.updated_at).toLocaleDateString()}),a.jsxs("td",{children:[a.jsxs("button",{className:"edit-button",onClick:()=>C(t),children:[a.jsx("i",{className:"fas fa-edit mr-2"}),"Edit"]}),a.jsxs("button",{className:"delete-button",onClick:()=>N(t.id_guru,"guru",t),children:[a.jsx("i",{className:"fas fa-trash-alt mr-2"}),"Hapus"]})]})]},t.id_guru))})]});case"wali":return a.jsxs("table",{className:"user-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Nama"}),a.jsx("th",{children:"Alamat"}),a.jsx("th",{children:"No. Telepon"}),a.jsx("th",{children:"Created At"}),a.jsx("th",{children:"Updated At"}),a.jsx("th",{children:"Aksi"})]})}),a.jsx("tbody",{children:n.map(t=>a.jsxs("tr",{children:[a.jsx("td",{children:t.nama}),a.jsx("td",{children:t.alamat}),a.jsx("td",{children:t.no_telp}),a.jsx("td",{children:new Date(t.created_at).toLocaleDateString()}),a.jsx("td",{children:new Date(t.updated_at).toLocaleDateString()}),a.jsxs("td",{children:[a.jsxs("button",{className:"edit-button",onClick:()=>C(t),children:[a.jsx("i",{className:"fas fa-edit mr-2"}),"Edit"]}),a.jsxs("button",{className:"delete-button",onClick:()=>N(t.id_wali,"wali",t),children:[a.jsx("i",{className:"fas fa-trash-alt mr-2"}),"Hapus"]})]})]},t.id_wali))})]});case"admin":return a.jsxs("table",{className:"user-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Nama"}),a.jsx("th",{children:"Tipe Admin"}),a.jsx("th",{children:"Created At"}),a.jsx("th",{children:"Aksi"})]})}),a.jsx("tbody",{children:n.map(t=>a.jsxs("tr",{children:[a.jsx("td",{children:t.nama}),a.jsx("td",{children:t.tipe_admin}),a.jsx("td",{children:new Date(t.created_at).toLocaleDateString()}),a.jsxs("td",{children:[a.jsxs("button",{className:"edit-button",onClick:()=>C(t),children:[a.jsx("i",{className:"fas fa-edit mr-2"}),"Edit"]}),a.jsxs("button",{className:"delete-button",onClick:()=>N(t.id_admin,"admin",t),children:[a.jsx("i",{className:"fas fa-trash-alt mr-2"}),"Hapus"]})]})]},t.id_admin))})]});default:return a.jsx("div",{className:"no-users",children:"Tab tidak valid"})}};return a.jsxs("div",{className:"users-container",children:[a.jsx("div",{className:"search-filter",children:a.jsx("input",{type:"text",className:"search-input",placeholder:`Cari ${l} berdasarkan nama, ${l==="siswa"?"NIS, atau alamat":l==="guru"?"NUPTK, nomor telepon, atau alamat":l==="wali"?"nomor telepon atau alamat":"tipe admin"}...`,value:g,onChange:t=>J(t.target.value)})}),a.jsx("div",{className:"table-actions",children:a.jsxs("button",{onClick:()=>{k(!1),b(null),r(y),x(!0)},children:[a.jsx("i",{className:"fas fa-plus-circle mr-2"}),"Tambah ",l]})}),n.length===0?a.jsxs("div",{className:"no-users",children:["Tidak ada pengguna ",l," yang ditemukan."]}):a.jsx("div",{className:"table-wrapper",children:i()})]})};return a.jsxs("div",{className:"admin-dashboard",children:[a.jsxs("div",{className:"dashboard-container",children:[a.jsx("h1",{children:"Dashboard Admin"}),a.jsx("div",{className:"admin-actions",children:a.jsxs("button",{className:"logout-button",onClick:W,children:[a.jsx("i",{className:"fas fa-sign-out-alt"}),"Logout"]})}),a.jsxs("div",{className:"tabs",children:[a.jsxs("button",{className:`tab ${l==="siswa"?"active":""}`,onClick:()=>_("siswa"),children:[a.jsx("i",{className:"fas fa-user-graduate mr-2"}),"Siswa (",u.siswa.length,")"]}),a.jsxs("button",{className:`tab ${l==="guru"?"active":""}`,onClick:()=>_("guru"),children:[a.jsx("i",{className:"fas fa-chalkboard-teacher mr-2"}),"Guru (",u.guru.length,")"]}),a.jsxs("button",{className:`tab ${l==="wali"?"active":""}`,onClick:()=>_("wali"),children:[a.jsx("i",{className:"fas fa-users mr-2"}),"Orang Tua (",u.wali.length,")"]}),a.jsxs("button",{className:`tab ${l==="admin"?"active":""}`,onClick:()=>_("admin"),children:[a.jsx("i",{className:"fas fa-user-shield mr-2"}),"Admin (",((K=u.admin)==null?void 0:K.length)||0,")"]})]}),a.jsx("div",{className:"users-container",children:V()})]}),z()]})};export{Q as default};
