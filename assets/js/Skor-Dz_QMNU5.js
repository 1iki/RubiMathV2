import{b as E,r as N,j as e,m as K}from"./vendor-BjgPdEnQ.js";/* empty css             */import{s as y}from"./game-DMqPqpoE.js";function T(){const c=E(),[h,_]=N.useState({name:"",role:"",avatar:null,id_kelas:null}),[r,G]=N.useState({totalScore:0,completedLevels:0,completedGames:0,totalGames:14,highestScore:0,recentActivity:[]}),D={1:{totalGames:4,title:"Bab 1"},2:{totalGames:4,title:"Bab 2"},3:{totalGames:2,title:"Bab 3"},4:{totalGames:2,title:"Bab 4"},5:{totalGames:1,title:"Bab 5"},6:{totalGames:1,title:"Bab 6"}};N.useEffect(()=>{(async()=>{const o=localStorage.getItem("userRole"),i=JSON.parse(localStorage.getItem("selectedAvatar")),a=localStorage.getItem("userKelas"),g=localStorage.getItem("id_siswa"),t=JSON.parse(localStorage.getItem("userData")||"{}");if(!i){c("/login");return}let d=null;if(t&&t.id_siswa)d=t;else try{let s=y.from("siswa").select("*");g?s=s.eq("id_siswa",g):s=s.ilike("nama",i.name);const{data:l,error:v}=await s.maybeSingle();v?console.error("Error fetching siswa:",v):l&&(localStorage.setItem("userData",JSON.stringify(l)),localStorage.setItem("userKelas",l.id_kelas.toString()),localStorage.setItem("id_siswa",l.id_siswa.toString()),d=l)}catch(s){console.error("Exception fetching siswa:",s),a&&(d={id_kelas:parseInt(a)})}d||(d={id_kelas:2},localStorage.setItem("userKelas","2")),_({name:(t==null?void 0:t.nama)||i.name||"Siswa",role:o||"siswa",avatar:{...i,displayName:(t==null?void 0:t.nama)||i.name},id_kelas:d.id_kelas});try{const{data:s,error:l}=await y.from("game_progress").select("*").eq("id_siswa",g).order("created_at",{ascending:!1});if(l){console.error("Error fetching progress:",l);return}let v=0,b=0,u=0,j=[];const p={};s.forEach(k=>{const{bab:m,level:S,skor:f,status_selesai:w,created_at:I}=k;p[m]||(p[m]=new Set),w&&(p[m].add(S),b++),v+=f||0,u=Math.max(u,f||0),j.push({bab:m,level:S,score:f,timestamp:I,status_selesai:w})}),j.sort((k,m)=>new Date(m.timestamp)-new Date(k.timestamp)),G({totalScore:v,completedGames:b,completedLevels:Object.keys(p).length,totalGames:14,highestScore:u,recentActivity:j})}catch(s){console.error("Error processing progress data:",s)}})()},[c]);const x=()=>Math.round(r.completedGames/r.totalGames*100),A=()=>{switch(h.id_kelas){case 2:c("/kelas2");break;case 4:c("/kelas4");break;case 5:c("/kelas5");break;case 6:c("/kelas6");break;default:c("/main-siswa")}},B=n=>{const o=new Date(n);return`${o.getDate()}/${o.getMonth()+1}/${o.getFullYear()}`};return e.jsxs(K.div,{className:"hasil-page skor-page",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[e.jsx("h1",{children:"Progres Belajarmu"}),e.jsxs("div",{className:"profile-info",children:[h.avatar&&e.jsx("div",{className:"avatar-container",children:e.jsx("img",{src:h.avatar.src,alt:"Avatar",className:"user-avatar"})}),e.jsxs("p",{children:["Hai, ",h.avatar?h.avatar.displayName:"Siswa","!"]})]}),e.jsxs("div",{className:"progress-overview",children:[e.jsxs("p",{children:["Total Skor: ",e.jsx("strong",{children:r.totalScore})]}),e.jsxs("p",{children:["Game Selesai: ",e.jsx("strong",{children:r.completedGames})," dari ",r.totalGames]}),e.jsxs("p",{children:["Progres Keseluruhan: ",e.jsxs("strong",{children:[x(),"%"]})]})]}),e.jsxs("div",{className:"skor-progress-container",children:[e.jsx("div",{className:"skor-progress-bar",children:e.jsx("div",{className:"skor-progress-fill",style:{width:`${x()}%`}})}),e.jsxs("p",{className:"progress-percentage",children:[x(),"%"]})]}),e.jsx("div",{className:"achievement-highlight",children:e.jsxs("p",{children:["Skor Tertinggi: ",e.jsx("strong",{children:r.highestScore})]})}),r.recentActivity.length>0?e.jsxs("div",{className:"recent-activities-container",children:[e.jsx("h2",{className:"aktivitas-title",children:"Aktivitas Terakhir"}),e.jsx("div",{className:"recent-activities-box",children:Object.entries(D).map(([n,o])=>{const i=r.recentActivity.filter(a=>a.bab===parseInt(n));return i.length===0?null:e.jsxs("div",{className:"bab-section",children:[e.jsx("h3",{className:"bab-title",children:o.title}),e.jsx("div",{className:"divider"}),e.jsx("div",{className:"activities-grid",children:i.map((a,g)=>e.jsxs("div",{className:"activity-white-card",children:[e.jsxs("div",{className:"activity-title",children:["Level ",a.level]}),e.jsxs("div",{className:"operation-score",children:["Skor: ",e.jsx("span",{children:a.score})]}),e.jsx("div",{className:"activity-status",children:a.status_selesai?"âœ… Selesai":"ðŸ”„ Dalam Progress"}),e.jsx("div",{className:"activity-date",children:B(a.timestamp)})]},g))})]},n)})})]}):e.jsxs("div",{className:"recent-activities-container empty-activities",children:[e.jsx("h2",{className:"aktivitas-title",children:"Aktivitas Terakhir"}),e.jsx("div",{className:"empty-message",children:e.jsx("p",{children:"Belum ada aktivitas. Ayo mulai belajar!"})})]}),e.jsx("div",{className:"navigation-buttons",children:e.jsx("button",{onClick:A,className:"menu-button",children:"Kembali ke Menu"})})]})}export{T as default};
