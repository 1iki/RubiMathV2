import{r as i,b as T,j as e,m as x}from"./vendor-BjgPdEnQ.js";import{b as X,a as F,s as W,g as J}from"./gold-B12Hfpl_.js";import{s as C}from"./game-C_1TzDD9.js";import{j as K}from"./guru-BwvXGu2s.js";const f={1:{levels:4,title:"Bab 1",description:"Bilangan Cacah"},2:{levels:4,title:"Bab 2",description:"Operasi Hitung"},3:{levels:2,title:"Bab 3",description:"Kelipatan dan Faktor"},4:{levels:2,title:"Bab 4",description:"Pengukuran"},5:{levels:1,title:"Bab 5",description:"Statistika"},6:{levels:1,title:"Bab 6",description:"Pengolahan Data"}},L=14,n=30,c=60,u=100;function Y(){const[d,I]=i.useState(null),[r,B]=i.useState(0),[b,z]=i.useState({}),[g,k]=i.useState(null),[v,w]=i.useState({completedLevels:0,totalScore:0,averageScore:0}),[V,y]=i.useState(!1),[S,A]=i.useState(0),o=T(),D=async a=>{try{let t=0,s=0,l=0;const p={};for(const[h,N]of Object.entries(f)){p[h]={completed:0,totalLevels:N.levels,scores:[]};for(let j=1;j<=N.levels;j++){const m=await K(4,parseInt(h),j);m&&(m.status_selesai&&(t++,p[h].completed++),m.skor&&(p[h].scores.push(m.skor),s+=m.skor,l++))}}const M=t/L*100,H=l>0?s/l:0;B(M),z(p),w({completedLevels:t,totalScore:s,averageScore:H})}catch(t){console.error("Error fetching game progress:",t)}};i.useEffect(()=>{if(console.log("MainSiswa4 mounted"),document.body.style.backgroundColor="#ffffff",document.body.style.color="#333333",!(localStorage.getItem("isLoggedIn")==="true")){o("/login");return}(async()=>{try{if(!C){console.warn("Database connection not available, using offline mode"),y(!0);return}await C.testConnection()||y(!0);const l=JSON.parse(localStorage.getItem("userData")||"{}");if(w(l),S>3){console.error("Too many navigation attempts, redirecting to login"),o("/login");return}}catch(s){console.error("Error checking database connection:",s),y(!0)}})()},[o,S]),i.useEffect(()=>{if(!(localStorage.getItem("isLoggedIn")==="true")){o("/login");return}const t=localStorage.getItem("userData"),s=t?JSON.parse(t):null;if(s&&s.nama)k({name:s.nama}),s.id_siswa&&D(s.id_siswa);else{console.warn("No user data found in localStorage"),o("/login");return}const l=localStorage.getItem("selectedAvatar");if(l){const p=JSON.parse(l);k({...p,displayName:s.nama})}},[o]);const P=(a,t)=>{const s=a+1,l=t+1;return completedCategoriesMap[`bab${s}_level${l}`]||!1},_=a=>{A(t=>t+1);try{a===0?(localStorage.setItem("currentBabIndex","0"),localStorage.setItem("currentLevelIndex","0"),o("/category4_bab1")):a===1?(localStorage.setItem("currentBabIndex","1"),localStorage.setItem("currentLevelIndex","0"),o("/category4_bab2")):a===2?(localStorage.setItem("currentBabIndex","2"),localStorage.setItem("currentLevelIndex","0"),o("/category4_bab3")):a===3?(localStorage.setItem("currentBabIndex","3"),localStorage.setItem("currentLevelIndex","0"),o("/category4_bab4")):a===4?(localStorage.setItem("currentBabIndex","4"),localStorage.setItem("currentLevelIndex","0"),o("/category4_bab5")):a===5?(localStorage.setItem("currentBabIndex","5"),localStorage.setItem("currentLevelIndex","0"),o("/category4_bab6")):I(a)}catch(t){console.error("Navigation error:",t),S>3&&o("/login")}},E=(a,t)=>{localStorage.setItem("currentBabIndex",a),localStorage.setItem("currentLevelIndex",t),o(`/category?chapter=${a}&level=${t}`)},O=()=>{I(null)},R=()=>{localStorage.removeItem("isLoggedIn"),o("/login")},$=()=>{o("/skor")},G=()=>e.jsxs("div",{className:"progress-container",style:{position:"relative",zIndex:1,backgroundColor:"transparent",padding:"15px"},children:[e.jsxs("div",{className:"progress-info",style:{color:"white"},children:[e.jsxs("p",{children:["Progress ",e.jsx("strong",{children:g?g.displayName:"Siswa"}),": ",Math.round(r),"%"]}),e.jsxs("p",{children:["Game Selesai: ",e.jsx("strong",{children:v.completedLevels})," dari ",L]}),v.averageScore>0&&e.jsxs("p",{children:["Rata-rata Skor: ",e.jsx("strong",{children:Math.round(v.averageScore)})]})]}),e.jsxs("div",{className:"progress-bar",style:{position:"relative",marginBottom:"20px",width:"90%",margin:"0 auto 30px auto",height:"15px",backgroundColor:"rgba(255, 255, 255, 0.2)",borderRadius:"10px",overflow:"hidden"},children:[e.jsx(x.div,{className:"progress",style:{width:`${r}%`,height:"100%",backgroundColor:"#ff5722",borderRadius:"10px",transition:"width 0.5s ease-out"},initial:{width:0},animate:{width:`${r}%`},transition:{duration:.8}}),e.jsx("div",{style:{position:"absolute",left:`${n}%`,top:-2,bottom:-2,width:"3px",backgroundColor:"#cd7f32",transform:"translateX(-50%)"}}),e.jsx("div",{style:{position:"absolute",left:`${c}%`,top:-2,bottom:-2,width:"3px",backgroundColor:"#c0c0c0",transform:"translateX(-50%)"}}),e.jsx("div",{style:{position:"absolute",right:"0",top:-2,bottom:-2,width:"3px",backgroundColor:"#ffd700",transform:"translateX(50%)"}})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"30px",position:"relative",padding:"0",height:"70px",width:"90%",margin:"0 auto",overflow:"visible"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",position:"absolute",left:`${n}%`,transform:"translateX(-50%)"},children:[e.jsx("img",{src:F,alt:"Bronze Badge",style:{width:"60px",height:"60px",marginRight:"10px",opacity:r>=n?"1":"0.4",filter:r>=n?"none":"grayscale(80%)",transition:"all 0.3s ease"}}),e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontWeight:"bold",fontSize:"0.9rem",textAlign:"left",opacity:r>=n?"1":"0.6"},children:"Bronze"}),e.jsxs("p",{style:{margin:"2px 0 0 0",fontSize:"0.8rem",textAlign:"left",color:r>=n?"#ff5722":"#999999"},children:[n,"%"]})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",position:"absolute",left:`${c}%`,transform:"translateX(-50%)"},children:[e.jsx("img",{src:W,alt:"Silver Badge",style:{width:"60px",height:"60px",marginRight:"10px",opacity:r>=c?"1":"0.4",filter:r>=c?"none":"grayscale(80%)",transition:"all 0.3s ease"}}),e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontWeight:"bold",fontSize:"0.9rem",textAlign:"left",opacity:r>=c?"1":"0.6"},children:"Silver"}),e.jsxs("p",{style:{margin:"2px 0 0 0",fontSize:"0.8rem",textAlign:"left",color:r>=c?"#ff5722":"#999999"},children:[c,"%"]})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",position:"absolute",left:"100%",transform:"translateX(-50%)"},children:[e.jsx("img",{src:J,alt:"Gold Badge",style:{width:"60px",height:"60px",marginRight:"10px",opacity:r>=u?"1":"0.4",filter:r>=u?"none":"grayscale(80%)",transition:"all 0.3s ease"}}),e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontWeight:"bold",fontSize:"0.9rem",textAlign:"left",opacity:r>=u?"1":"0.6"},children:"Gold"}),e.jsxs("p",{style:{margin:"2px 0 0 0",fontSize:"0.8rem",textAlign:"left",color:r>=u?"#ff5722":"#999999"},children:[u,"%"]})]})]})]})]});return e.jsxs("div",{className:"main-siswa-container",style:{color:"#333333",backgroundImage:`url(${X})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",position:"relative"},children:[e.jsxs("header",{className:"header-siswa",style:{position:"relative",zIndex:1},children:["        ",e.jsx(x.h1,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},style:{color:"#ff5722",textShadow:"2px 2px 4px rgba(0,0,0,0.5)"},children:"Game Matematika Siswa"}),e.jsxs("div",{className:"profile-section",children:[e.jsx("div",{className:"profile-icon",children:g?e.jsx("img",{src:g.src,alt:g.displayName||g.name,className:"avatar-image"}):"ðŸ‘¤"}),e.jsxs("div",{className:"profile-actions",children:[e.jsx("button",{onClick:$,className:"score-button",children:"Lihat Progres"}),e.jsx("button",{onClick:R,className:"logout-button",children:"Keluar"}),"          "]})]})]}),G(),e.jsx("div",{className:"chapter-buttons",style:{position:"relative",zIndex:1},children:Object.entries(f).map(([a,t],s)=>e.jsxs(x.button,{className:"big-chapter-button",onClick:()=>_(parseInt(a)-1),initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{delay:.2*s},style:{backgroundColor:"rgba(0, 0, 0, 0.6)",color:"white",textShadow:"1px 1px 2px black",padding:"25px 15px 15px",fontSize:"1.5rem",fontWeight:"bold",display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx("div",{children:t.title}),e.jsx("div",{style:{fontSize:"1rem",opacity:.8},children:t.description}),b[a]&&e.jsxs("div",{style:{fontSize:"0.9rem",marginTop:"8px",color:b[a].completed===t.levels?"#4CAF50":"#FFA726"},children:[b[a].completed,"/",t.levels," Selesai"]})]},a))}),"      ",d!==null&&d!==0&&e.jsx("div",{className:"popup-overlay",style:{zIndex:10,backgroundColor:"rgba(0, 0, 0, 0.7)"},children:e.jsxs(x.div,{className:"popup",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3},style:{backgroundColor:"rgba(0, 0, 0, 0.8)",border:"2px solid #ff5722",color:"white"},children:["            ",e.jsx("h2",{children:f[d+1].title}),e.jsx("div",{className:"levels",children:f[d+1].levels.map((a,t)=>e.jsx("div",{className:"level-container",children:e.jsx("button",{className:`level-button ${P(d,t)?"level-completed":""}`,onClick:()=>E(d,t),children:a})},t))}),e.jsx("button",{className:"close-popup-button",onClick:O,children:"âœ– Kembali ke Menu"})]})})]})}export{Y as default};
