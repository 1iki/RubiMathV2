import{b as Q,h as G,r as n,j as r}from"./vendor-BjgPdEnQ.js";import{R as J}from"./react-confetti-ho-PuuYM.js";import{u as K,s as k}from"./game-C_1TzDD9.js";/* empty css                    */const Z=()=>{const f=Q(),c=G(),{user:h,loading:b}=K(),[u,E]=n.useState(1),[d]=n.useState(5),[o,x]=n.useState(0),[l,N]=n.useState({num1:0,num2:0}),[i,y]=n.useState(null),[O,B]=n.useState([]),[H,w]=n.useState(null),[p,L]=n.useState(null),[M,v]=n.useState(!1),[W,R]=n.useState("Bab 1 Level 1 Pengurangan"),[g,S]=n.useState({run:!1,recycle:!0,numberOfPieces:500,gravity:.3});if(n.useEffect(()=>{!b&&!h&&f("/login")},[h,b,f]),b)return r.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-blue-200 p-4 flex items-center justify-center",children:r.jsx("div",{className:"text-2xl font-bold text-gray-700",children:"Loading..."})});if(!h)return null;const $=async()=>{try{const{data:e,error:t}=await k.from("siswa").select("id_siswa").eq("auth_user_id",h.id).single();if(t){console.error("Error getting siswa data:",t);return}const s={id_siswa:e.id_siswa,kelas:1,bab:1,level:1,jenis_permainan:"Pengurangan",skor:o,skor_maksimal:100,status_selesai:u>d,detail_jawaban:{jawaban:[{total_benar:o/20,total_soal:d}]}},{error:a}=await k.rpc("update_game_progress",s);if(a){console.error("Error saving game progress:",a);return}console.log("Game progress saved successfully!")}catch(e){console.error("Error in saveGameProgress:",e)}};n.useEffect(()=>{(o>0||u>d)&&$()},[o,u]),n.useEffect(()=>{const e=c.pathname.split("/");let t=0,s=0;c.state&&c.state.babIndex!==void 0?(t=c.state.babIndex,s=c.state.levelIndex||0):e.length>=4&&(t=parseInt(e[e.length-2])||0,s=parseInt(e[e.length-1])||0);const a=new URLSearchParams(c.search),m=a.get("chapter"),C=a.get("level");m!==null&&C!==null&&(t=parseInt(m),s=parseInt(C)),R(`Bab ${t+1} Level ${s+1} Pengurangan`);const I=`bab${t}_level${s}`;localStorage.setItem("currentLevelKey",I);const P=localStorage.getItem("selectedAvatar");if(P){const _=`avatar_${JSON.parse(P).name}_operations`,A=JSON.parse(localStorage.getItem(_))||{};A[I]="subtraction",localStorage.setItem(_,JSON.stringify(A)),localStorage.setItem("currentOperation","subtraction")}},[c]),n.useEffect(()=>{j()},[]);const j=()=>{const e=Math.floor(Math.random()*30)+10,t=Math.floor(Math.random()*9)+1;N({num1:e,num2:t});const s=e-t;let a=[s,s+1,s-1,s+2];for(a=[...new Set(a)];a.length<4;){const m=s+Math.floor(Math.random()*6)-3;a.includes(m)||a.push(m)}B(z(a))},z=e=>e.sort(()=>Math.random()-.5),T=e=>{y(e),L(i);const t=e===l.num1-l.num2;w(t),t?(v(!0),S({...g,run:!0,recycle:!0,numberOfPieces:500}),setTimeout(()=>{S({...g,run:!1}),setTimeout(()=>{v(!1)},500)},4e3),(!p||p!==l.num1-l.num2)&&x(o+1)):p&&p===l.num1-l.num2&&x(o-1)},q=()=>{u<d?(E(u+1),j(),y(null),w(null)):f(`/hasil/${o}`,{state:{score:o,totalQuestions:d}})},D=()=>{f("/category")};return r.jsxs("div",{className:"game-page",style:{background:"linear-gradient(to bottom, #00c6fb, #005bea)",minHeight:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"20px"},children:[r.jsx("button",{className:"close-button",onClick:D,children:r.jsx("span",{className:"close-button-text",children:"Ã—"})}),M&&r.jsx(J,{width:window.innerWidth,height:window.innerHeight,recycle:g.recycle,run:g.run,numberOfPieces:g.numberOfPieces,gravity:g.gravity}),r.jsxs("div",{style:{marginBottom:"30px",textAlign:"center"},children:[r.jsx("h1",{style:{color:"white",fontSize:"1.8rem",fontWeight:"700",marginBottom:"10px"},children:W}),r.jsxs("h2",{style:{color:"white",fontSize:"1.2rem"},children:["Pertanyaan ",u," dari ",d]})]}),r.jsxs("div",{style:{fontSize:"5rem",color:"white",fontWeight:"bold",marginBottom:"60px",textAlign:"center"},children:[l.num1,"-",l.num2,"=?"]}),r.jsx("div",{style:{display:"flex",justifyContent:"center",flexWrap:"wrap",gap:"30px",maxWidth:"650px"},children:O.map((e,t)=>r.jsx("button",{onClick:()=>T(e),style:{backgroundColor:i===e?"#65b4ff":"#7ad0ff",color:"white",borderRadius:"50%",width:"90px",height:"90px",fontSize:"2.5rem",fontWeight:"bold",boxShadow:"0 5px 15px rgba(0,0,0,0.2)",border:"none",cursor:"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",outline:i===e?"4px solid rgba(255,255,255,0.5)":"none"},children:e},t))}),r.jsx("button",{onClick:q,disabled:i===null,style:{padding:"15px 40px",backgroundColor:i===null?"rgba(230, 230, 230, 0.5)":"rgba(230, 230, 230, 0.9)",color:i===null?"#888":"#333",border:"none",borderRadius:"10px",fontSize:"1.2rem",fontWeight:"bold",marginTop:"60px",cursor:i===null?"not-allowed":"pointer",boxShadow:"0 4px 8px rgba(0,0,0,0.2)",opacity:i===null?"0.7":"1"},children:"Pertanyaan Selanjutnya"})]})};export{Z as default};
