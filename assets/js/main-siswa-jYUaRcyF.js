import{r as n,b as q,j as e,m as j}from"./vendor-BjgPdEnQ.js";const r=[{title:"Bab 1",levels:["Level 1"]},{title:"Bab 2",levels:["Level 1"]},{title:"Bab 3",levels:["Level 1"]}],N=["addition","subtraction","multiplication","division"];function Q(){const[l,b]=n.useState(null),[p,P]=n.useState(0),[g,_]=n.useState(Array(r.length).fill(0)),[i,M]=n.useState(null),[S,K]=n.useState({completedLevels:0}),[c,A]=n.useState({}),y=q();n.useEffect(()=>{if(!(localStorage.getItem("isLoggedIn")==="true")){y("/login");return}const s=localStorage.getItem("userData"),t=s?JSON.parse(s):null,o=localStorage.getItem("selectedAvatar");if(o){const d=JSON.parse(o);M({...d,displayName:(t==null?void 0:t.nama)||d.name});const J=`avatar_${d.name}_levelScores`;JSON.parse(localStorage.getItem(J));const B=`avatar_${d.name}_operations`,D=JSON.parse(localStorage.getItem(B))||{},f={};let $=0;const h=Array(r.length).fill(0);r.forEach((m,v)=>{let R=m.levels.length*N.length,C=0,L=!1;m.levels.forEach((z,U)=>{const w=`bab${v}_level${U}`,u=D[w]||[];f[w]=u,u.length===N.length&&$++,C+=u.length,u.length>0&&(L=!0)}),h[v]=L?C/R*100:0}),_(h),K({completedLevels:$}),A(f);const G=h.reduce((m,v)=>m+v,0)/r.length;P(G);const H=`avatar_${d.name}_chapterProgress`;localStorage.setItem(H,JSON.stringify(h))}},[y]);const O=(a,s)=>{localStorage.setItem("currentBabIndex",a),localStorage.setItem("currentLevelIndex",s),y(`/category?chapter=${a}&level=${s}`)},k=()=>{b(null)},I=(a,s)=>{if(!i)return!1;const t=`bab${a}_level${s}`;return c[t]&&c[t].length>0},E=(a,s)=>{if(!i)return 0;const t=`bab${a}_level${s}`;return c[t]?c[t].length/N.length*100:0},x=(a,s,t)=>{if(!i)return!1;const o=`bab${a}_level${s}`;return c[o]&&c[o].includes(t)};return e.jsxs("div",{className:"main-siswa-container",children:[e.jsxs("header",{className:"header-siswa",children:[e.jsx(j.h1,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},children:"Game Matematika Siswa"}),e.jsxs("div",{className:"profile-section",children:[e.jsx("div",{className:"profile-icon",children:i?e.jsx("img",{src:i.src,alt:i.displayName,className:"avatar-image"}):"ðŸ‘¤"}),e.jsxs("div",{className:"progress-info",children:[e.jsxs("p",{children:["Progress"," ",e.jsx("strong",{children:i?i.displayName:"Siswa"}),":"," ",Math.round(p),"%"]}),e.jsxs("p",{children:["Level Selesai:"," ",e.jsx("strong",{children:S.completedLevels})," dari"," ",r.length*r[0].levels.length]})]})]})]}),e.jsxs("div",{className:"progress-container",children:[e.jsxs("div",{className:"progress-info",children:[e.jsxs("p",{children:["Progress"," ",e.jsx("strong",{children:i?i.name:"Siswa"}),":"," ",Math.round(p),"%"]}),e.jsxs("p",{children:["Level Selesai:"," ",e.jsx("strong",{children:S.completedLevels})," dari"," ",r.length*r[0].levels.length]})]}),e.jsx("div",{className:"progress-bar",children:e.jsx(j.div,{className:"progress",style:{width:`${p}%`},initial:{width:0},animate:{width:`${p}%`},transition:{duration:.8}})})]}),e.jsx("div",{className:"chapter-buttons",children:r.map((a,s)=>e.jsxs(j.button,{className:"big-chapter-button",onClick:()=>b(s),initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{delay:.2*s},children:[a.title,e.jsxs("div",{className:"chapter-progress-indicator",children:[e.jsx("div",{className:"chapter-progress-bar",children:e.jsx("div",{className:"chapter-progress-fill",style:{width:`${g[s]}%`}})}),e.jsxs("span",{children:[Math.round(g[s]),"%"]})]})]},s))}),l!==null&&e.jsx("div",{className:"popup-overlay",children:e.jsxs(j.div,{className:"popup",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3},children:[e.jsx("h2",{children:r[l].title}),e.jsx("div",{className:"popup-progress-bar",children:e.jsx("div",{className:"popup-progress",style:{width:`${g[l]}%`}})}),e.jsxs("p",{className:"progress-text",children:[Math.round(g[l]),"% selesai"]}),e.jsx("div",{className:"levels",children:r[l].levels.map((a,s)=>e.jsxs("div",{className:"level-container",children:[e.jsxs("button",{className:`level-button ${I(l,s)?"level-completed":""}`,onClick:()=>O(l,s),children:[a,e.jsx("div",{className:"level-progress-bar",children:e.jsx("div",{className:"level-progress-fill",style:{width:`${E(l,s)}%`}})})]}),e.jsx("div",{className:"category-indicators",children:N.map((t,o)=>e.jsx("div",{className:`category-indicator ${x(l,s,t)?"category-completed":""}`,title:`${t} ${x(l,s,t)?"(completed)":"(not completed)"}`,children:x(l,s,t)&&"âœ“"},o))})]},s))}),e.jsx("button",{className:"close-popup-button",onClick:k,children:"âœ– Kembali ke Menu"})]})})]})}export{Q as default};
